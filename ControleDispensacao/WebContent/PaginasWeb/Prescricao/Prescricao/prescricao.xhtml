<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.prime.com.tr/ui"
	template="/Templates/templatePadrao.xhtml">

	<ui:define name="head">
	</ui:define>


	<ui:define name="conteudoPadrao">
		<p:tab id="tabPrescricao" title="Prescrição" >
			<h:form id="prescricaoForm" prependId="false" >
				<p:growl showDetail="true" />
				<h:panelGrid id="prescricaoPanelGrid"
							 columns="3"
							 width="100%" >
					<h:panelGroup>
						<font color="red" >*</font><h:outputLabel for="paciente" value="Paciente:" /><br />
				  		<p:autoComplete id="paciente" 
				  						required="true"
				  						forceSelection="true"
				  						immediate="true"
				  						value="#{prescricaoHome.instancia.paciente}"
										completeMethod="#{pacienteHome.getListaPacienteAutoComplete}" 
										var="paciente" 
										itemLabel="#{paciente.nome}"
										itemValue="#{paciente}"
										converter="pacienteConversor" />
					</h:panelGroup>
					<h:panelGroup>
						<font color="red" >*</font><h:outputLabel for="massa" value="Peso:"  /><br />
						<p:inputText  id="massa"
									  value="#{prescricaoHome.instancia.massa}"
									  onkeyup="apenasNumeroComVirgula(this);" 
									  converter="monetarioConversor"
									  title="Massa do paciente" />
					</h:panelGroup>
					<h:panelGroup>
						<font color="red" >*</font><h:outputLabel for="leito" value="Leito:"  /><br />
						<p:inputText  id="leito"
									  value="#{prescricaoHome.instancia.leito}"
									  title="Leito ao qual o paciente está em repouso" />
					</h:panelGroup>
					
					<h:panelGroup>
						<p:commandButton value="Indicar dosagem"
										 ajax="true"
										 action="#{prescricaoHome.iniciaDosagem()}" 
										 update="padraoTabView:itemDosePanelGrid padraoTabView:doseGrid padraoTabView:doseDialog" />
					</h:panelGroup>
				</h:panelGrid>
				
				<p:dataGrid id="prescricaoItensGrid"
							var="item" 
							value="#{prescricaoHome.prescricaoItensList}" 
							columns="3"
					        paginator="false">
			        <p:column>  
			            <p:panel header="#{item.material.descricao}" style="text-align:center">  
			                <h:panelGrid columns="1" style="width:100%">  
			                    <h:outputText value="#{prescricaoHome.quantidadeDosesPrescricaoItem(item)} dose(s)" />
			                    <h:outputText value="#{item.observacao}" />
			                    <p:commandLink title="Mostrar as doses"
			                    			   oncomplete="dosagemDialog.show();"
			                    			   update="padraoTabView:itemDosePanelGrid padraoTabView:doseGrid prescricaoForm"
			                    			   rendered="false"
			                    			   >
			                        <p:graphicImage value="/Imagens/pills32px.png"/>
			                        <f:setPropertyActionListener value="#{item}" target="#{prescricaoHome.prescricaoItem}" />
			                    </p:commandLink>  
			                    <p:commandLink title="Remover este item da prescrição" 
			                    			   immediate="true"
			                    			   action="#{prescricaoHome.removePrescricaoItem(item)}" 
			                    			   update="prescricaoItensGrid" >
			                        <p:graphicImage value="/Imagens/delete16.gif"/>
			                    </p:commandLink>
			                </h:panelGrid>  
			            </p:panel>  
			        </p:column>  
				</p:dataGrid>
				
				<p:commandButton value="Prescrever"
								 action="#{prescricaoHome.finalizarPrescricao()}" 
								 update="prescricaoForm padraoTabView:doseDialog" />
				
				<p:commandButton value="Cancelar Prescrição"
								 action="#{prescricaoHome.cancelarPrescricao()}" 
								 update="prescricaoForm padraoTabView:doseDialog" />
			</h:form>
			<h:form id="doseDialogForm" 
					prependId="false" >
					<p:growl showDetail="true" />
				<p:dialog id="doseDialog"
						  visible="#{prescricaoHome.iniciaDosagem}"
						  header="Informe a dosagem do medicamento" 
						  widgetVar="dosagemDialog" 
						  modal="true" 
						  closable="false">
								<h:panelGrid id="itemDosePanelGrid" 
											 columns="2"
											 width="100%"
											 cellpadding="5px">
									<h:panelGroup style="align:left;" >
									<font color="red" >*</font><h:outputLabel for="material" value="Material:"  /><br />
							  		<p:autoComplete id="material" 
							  						disabled="#{!(prescricaoHome.prescricaoItemDoseList.size() == 0)}"
							  						value="#{prescricaoHome.prescricaoItem.material}"
													completeMethod="#{materialHome.getListaMaterialAutoComplete}" 
													var="material"
													required="true"
													forceSelection="true"
													title="Informe o medicamento a ser prescrito"
													itemLabel="#{material.descricao}" 
													itemValue="#{material}"
													converter="materialConversor" />
								</h:panelGroup>
								
								<h:panelGroup>
									<h:outputLabel for="observacao" value="Observação:"  /><br />
									<p:inputTextarea value="#{prescricaoHome.prescricaoItem.observacao}"
													 autoResize="false" 
													 cols="30"/>
								</h:panelGroup>
								
								<h:panelGroup >
									<font color="red" >*</font><h:outputLabel for="quantidadeDoses" value="Quantidade de doses diárias:"  /><br />
									<p:inputText id="quantidadeDoses"
											  	 value="#{prescricaoHome.quantidadeDoses}"
											  	 title="Período em horas" />
								</h:panelGroup>
								
								<h:panelGroup >
									<font color="red" >*</font><h:outputLabel for="quantidadeMedicamento" value="Quantidade do medicamento por dose:"  /><br />
									<p:inputText id="quantidadeMedicamento"
											  	 value="#{prescricaoHome.quantidadePorDose}"
											  	 onkeyup="apenasNumero(this);"
											  	 title="Quantidade a ser ministrado ao paciente" />
									<h:outputText id="unidadeMaterial"
												  value="#{prescricaoHome.prescricaoItem.material.unidadeMaterial.sigla}" />
								</h:panelGroup>
								
								<h:panelGroup >
									<font color="red" >*</font><h:outputLabel for="intervaloDoses" value="Intervalo entre as doses:"  /><br />
									<p:inputText id="intervaloDoses"
											  	 value="#{prescricaoHome.intervaloEntreDoses}"
											  	 title="Intervalo de uma dose para a outra" />h
								</h:panelGroup>
								
								<h:panelGroup >
									<font color="red" >*</font><h:outputLabel for="horaInicial" value="Início da dosagem:"  /><br />
									<p:calendar id="dataIncial"
												pattern="dd/MM/yyyy HH:mm"
												locale="pt_BR" 
												value="#{prescricaoHome.dataInicio}" />  
								</h:panelGroup>
								
								<h:panelGroup>
									<p:commandButton action="#{prescricaoHome.primeiraLiberacaoDose()}"
													 value="Adicionar dose" 
													 update="doseDialogForm doseGrid" />
								</h:panelGroup>
							</h:panelGrid>
							<p:separator id="limiteGridSeparator1" style="height:8px" /> 
							<p:growl showDetail="true" />
							<p:dataGrid id="doseGrid"
									var="itemDose" 
									value="#{prescricaoHome.prescricaoItemDoseList}" 
									columns="3"
							        paginator="false">  
						        <p:column>  
						        
						            <p:panel style="text-align:center">
						                <h:panelGrid columns="1" style="width:100%">  
						                	<h:panelGroup>
						                		<h:outputText value="Período: "/>
						                    	<h:outputText value="#{itemDose.dataDose}" >
						                    		<f:convertDateTime pattern="dd/MM/yyyy HH:mm"/>
						                    	</h:outputText>
						                    </h:panelGroup>
						                    <h:panelGroup>
						                    	<h:outputText value="Quantidade: " />
						                    	<h:outputText value="#{itemDose.quantidade}" />
						                    </h:panelGroup>
						                    
						                    <p:commandLink  action="#{prescricaoHome.removeDose(itemDose)}"
															update="doseGrid" 
															title="Apagar" 
															style="padding-right:10px;" >
												<h:graphicImage value="/Imagens/delete.png" />
											</p:commandLink>
						                </h:panelGrid>
						            </p:panel>  
						        </p:column>  
							</p:dataGrid>
							
							<p:separator id="limiteGridSeparator2" style="height:8px" />
							<h:panelGroup>
								<p:commandButton action="#{prescricaoHome.finalizaDosagem()}"
												 value="Concluir" 
												 update="doseDialogForm"/> 
							</h:panelGroup>
							
							<h:panelGroup>
								<p:commandButton action="#{prescricaoHome.cancelaDosagem()}"
												 value="Cancelar"
												 immediate="true"
												 oncomplete="window.location.reload();"/>
							</h:panelGroup>
				</p:dialog>
				
				<p:dialog id="liberacaoDialog"
						  visible="#{prescricaoHome.mostraModalLiberacaoMedicamento}"
						  header="Painel de liberação" 
						  widgetVar="liberacaoDialog" 
						  modal="true" 
						  closable="false">
						  
					<h:panelGrid columns="2" >
						<h:panelGroup>
							<font color="red" >*</font><h:outputText value="Usuário: " /><br />
							<p:inputText value="#{prescricaoHome.usuario}" 
										 label="Usuário" />
						</h:panelGroup>
						<h:panelGroup >
							<font color="red" >*</font><h:outputText value="Senha: " /><br />
							<p:inputText value="#{prescricaoHome.senha}" 
										 label="Senha" 
										 type="password" />
						</h:panelGroup>
						
						<h:panelGroup >
							<p:commandButton action="#{prescricaoHome.segundaLiberacaoDose()}"
													 value="Liberar"
													 update="doseDialogForm"/>
						</h:panelGroup>
						
						<h:panelGroup >
							<p:commandButton action="#{prescricaoHome.cancelaAutorizacaoMaterial()}"
													 value="Cancelar"
													 oncomplete="window.location.reload();"/>
						</h:panelGroup>
					</h:panelGrid>
						  
				</p:dialog>
			</h:form>
		</p:tab>
	</ui:define>
</ui:composition>