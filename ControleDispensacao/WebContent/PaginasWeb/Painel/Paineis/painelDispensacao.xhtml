<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui"
	template="/Templates/templatePadrao.xhtml">

	<ui:define name="head">
	</ui:define>


	<ui:define name="conteudoPadrao">
		<p:tab id="tabPrescricao" title="Prescrição">
			<h:form id="prescricaoForm" prependId="false">
				<p:growl showDetail="true" />
				<h:panelGrid id="prescricaoPanelGrid" columns="3" width="100%">
					<h:panelGroup>
						<font color="red">*</font>
						<h:outputLabel for="paciente" value="Paciente:" />
						<br />
						<p:autoComplete id="paciente" required="true"
							forceSelection="true" immediate="true"
							value="#{prescricaoRaiz.instancia.paciente}"
							completeMethod="#{pacienteRaiz.getListaPacienteAutoComplete}"
							var="paciente" itemLabel="#{paciente.nome}"
							itemValue="#{paciente}" converter="pacienteConversor" />
						<h:graphicImage value="/Imagens/list16.png"
							title="Ao digitar aparecerá algumas sugestões"
							style="padding-top:8px" />
					</h:panelGroup>
					<h:panelGroup>
						<font color="red">*</font>
						<h:outputLabel for="massa" value="Massa:" />
						<br />
						<p:inputText id="massa" value="#{prescricaoRaiz.instancia.massa}"
							onkeyup="apenasNumeroComVirgula(this);"
							converter="monetarioConversor" title="Massa do paciente" />
					</h:panelGroup>
					<h:panelGroup>
						<font color="red">*</font>
						<h:outputLabel for="leito" value="Leito:" />
						<br />
						<p:inputText id="leito" value="#{prescricaoRaiz.instancia.leito}"
							title="Leito ao qual o paciente está em repouso" />
					</h:panelGroup>

					<h:panelGroup>
						<p:commandButton value="Indicar dosagem" ajax="true"
							action="#{prescricaoRaiz.iniciaDosagem()}"
							update="padraoTabView:itemDosePanelGrid padraoTabView:doseGrid padraoTabView:doseDialog" />
					</h:panelGroup>
				</h:panelGrid>

				<p:dataGrid id="prescricaoItensGrid" var="item"
					value="#{prescricaoRaiz.prescricaoItensList}" columns="3"
					paginator="false">
					<p:column>
						<p:panel header="#{item.material.descricao}"
							style="text-align:center">
							<h:panelGrid columns="1" style="width:100%">
								<h:outputText
									value="#{prescricaoRaiz.quantidadeDosesPrescricaoItem(item)} dose(s)" />
								<h:outputText value="#{item.observacao}" />
								<p:commandLink title="Mostrar as doses"
									oncomplete="dosagemDialog.show();"
									update="padraoTabView:itemDosePanelGrid padraoTabView:doseGrid prescricaoForm"
									rendered="false">
									<p:graphicImage value="/Imagens/pills32px.png" />
									<f:setPropertyActionListener value="#{item}"
										target="#{prescricaoRaiz.prescricaoItem}" />
								</p:commandLink>
								<p:commandLink title="Remover este item da prescrição"
									immediate="true"
									action="#{prescricaoRaiz.removePrescricaoItem(item)}"
									update="prescricaoItensGrid">
									<p:graphicImage value="/Imagens/delete16.gif" />
								</p:commandLink>
							</h:panelGrid>
						</p:panel>
					</p:column>
				</p:dataGrid>

				<p:commandButton value="Prescrever"
					action="#{prescricaoRaiz.finalizarPrescricao()}"
					update="prescricaoForm padraoTabView:doseDialog" />

				<p:commandButton value="Cancelar Prescrição"
					action="#{prescricaoRaiz.cancelarPrescricao()}"
					update="prescricaoForm padraoTabView:doseDialog" />
			</h:form>
			<p:dialog id="doseDialog" visible="#{prescricaoRaiz.iniciaDosagem}"
				header="Informe a dosagem do medicamento" widgetVar="dosagemDialog"
				modal="true" closable="false">
				<h:form id="doseDialogForm" prependId="false">
					<h:panelGrid id="itemDosePanelGrid" columns="2" width="100%"
						cellpadding="5px">
						<h:panelGroup style="align:left;">
							<font color="red">*</font>
							<h:outputLabel for="material" value="Material:" />
							<br />
							<p:autoComplete id="material"
								value="#{prescricaoRaiz.prescricaoItem.material}"
								completeMethod="#{materialRaiz.getListaMaterialAutoComplete}"
								var="material" required="true" forceSelection="true"
								title="Informe o medicamento a ser prescrito"
								itemLabel="#{material.descricao}" itemValue="#{material}"
								converter="materialConversor" />
							<h:graphicImage value="/Imagens/list16.png"
								title="Ao digitar aparecerá algumas sugestões"
								style="padding-top:8px" />
						</h:panelGroup>

						<h:panelGroup>
							<h:outputLabel for="observacao" value="Observação:" />
							<br />
							<p:inputTextarea
								value="#{prescricaoRaiz.prescricaoItem.observacao}"
								autoResize="false" cols="30" />
						</h:panelGroup>

						<h:panelGroup>
							<font color="red">*</font>
							<h:outputLabel for="quantidadeDoses"
								value="Quantidade de doses diárias:" />
							<br />
							<p:inputText id="quantidadeDoses"
								value="#{prescricaoRaiz.quantidadeDoses}"
								title="Período em horas" />
						</h:panelGroup>

						<h:panelGroup>
							<font color="red">*</font>
							<h:outputLabel for="quantidadeMedicamento"
								value="Quantidade do medicamento por dose:" />
							<br />
							<p:inputText id="quantidadeMedicamento"
								value="#{prescricaoRaiz.quantidadePorDose}"
								title="Quantidade a ser ministrado ao paciente" />
							<h:outputText id="unidadeMaterial"
								value="#{prescricaoRaiz.prescricaoItem.material.unidadeMaterial.sigla}" />
						</h:panelGroup>

						<h:panelGroup>
							<font color="red">*</font>
							<h:outputLabel for="intervaloDoses"
								value="Intervalo entre as doses:" />
							<br />
							<p:inputText id="intervaloDoses"
								value="#{prescricaoRaiz.intervaloEntreDoses}"
								title="Intervalo de uma dose para a outra" />h
							</h:panelGroup>

						<h:panelGroup>
							<font color="red">*</font>
							<h:outputLabel for="horaInicial" value="Início da dosagem:" />
							<br />
							<p:calendar id="dataIncial" pattern="dd/MM/yyyy HH:mm"
								locale="pt_BR" value="#{prescricaoRaiz.dataInicio}" />
						</h:panelGroup>

						<h:panelGroup>
							<p:commandButton action="#{prescricaoRaiz.adicionaDoses()}"
								value="Adicionar dose" update="doseDialogForm doseGrid" />
						</h:panelGroup>
					</h:panelGrid>
					<p:separator id="limiteGridSeparator1" style="height:8px" />
					<p:growl showDetail="true" />
					<p:dataGrid id="doseGrid" var="itemDose"
						value="#{prescricaoRaiz.prescricaoItemDoseList}" columns="3"
						paginator="false">
						<p:column>

							<p:panel style="text-align:center">
								<h:panelGrid columns="1" style="width:100%">
									<h:panelGroup>
										<h:outputText value="Período: " />
										<h:outputText value="#{itemDose.dataDose}">
											<f:convertDateTime pattern="dd/MM/yyyy HH:mm" />
										</h:outputText>
									</h:panelGroup>
									<h:panelGroup>
										<h:outputText value="Quantidade: " />
										<h:outputText value="#{itemDose.quantidade}" />
									</h:panelGroup>

									<p:commandLink action="#{prescricaoRaiz.removeDose(itemDose)}"
										update="doseGrid" title="Apagar" style="padding-right:10px;">
										<h:graphicImage value="/Imagens/delete.png" />
									</p:commandLink>
								</h:panelGrid>
							</p:panel>
						</p:column>
					</p:dataGrid>

					<p:separator id="limiteGridSeparator2" style="height:8px" />
					<h:panelGroup>
						<p:commandButton action="#{prescricaoRaiz.finalizaDosagem()}"
							value="Concluir" update="doseDialogForm" />
					</h:panelGroup>

					<h:panelGroup>
						<p:commandButton action="#{prescricaoRaiz.cancelaDosagem()}"
							value="Cancelar" immediate="true"
							oncomplete="window.location.reload();" />
					</h:panelGroup>
				</h:form>
			</p:dialog>
		</p:tab>
	</ui:define>
</ui:composition>